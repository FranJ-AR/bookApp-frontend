<div class="c-info-search">
  <p>Proporciona como mínimo caracteres del título o del autor de la obra para iniciar búsqueda</p>
</div>
<form>
  <div class="c-group-field">
    <div class="c-field">
      <label for="fname">Título</label><br>
      <div class="input-group">
        <input type="text" class="form-control" id="ftitle" name="ftitle" [(ngModel)]="selectedTitleSubString">
        <div class="input-group-append">
          <button class="btn btn-secondary" (click)="triggerSearch()" type="button">
            <fa-icon [icon]="searchIcon"></fa-icon>
          </button>
        </div>
      </div>
    </div>

    <div class="c-field">
      <label for="fname">Escrito por</label><br>
      <div class="input-group">
        <input type="text" class="form-control" id="fauthor" name="fauthor" autocomplete="off"
          [(ngModel)]="selectedAuthorName" (keyup)="getAuthorsBySubtring(selectedAuthorName)">
        <div class="input-group-append">
          <button class="btn btn-secondary" (click)="removeAuthor()" type="button">
            <fa-icon [icon]="eraserIcon"></fa-icon>
          </button>
        </div>
      </div>


      <br>

      <div class="c-author-container">
        <table class="table table-bordered c-author" *ngIf="showAuthorDropdown">
          <tr *ngFor="let author of authors" (click)="selectAuthor(author.id,author.name)">
            <td>
              {{author.name}}
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <div class="c-group-field">
    <div class="c-field">
      <label for="cars">Categorías</label>

      <select class="form-control c-form" name="cars" id="cars" [(ngModel)]="selectedCategoryId"
        (change)="triggerSearch()">
        <option class="form-control" *ngFor="let category of categories" [value]="category.id"> {{category.name}}
        </option>
      </select>

    </div>
    <div class="c-field">
      <label for="cars">Subcategorías</label>
      <select class="form-control c-form" name="cars" id="cars" [(ngModel)]="selectedSubcategoryId"
        (change)="triggerSearch()">
        <option *ngFor="let subcategory of subcategories" [value]="subcategory.id"> {{subcategory.name}}
        </option>
      </select>
    </div>
  </div>

</form>

<div class="c-warn-searching" *ngIf="books.length === 0 || noAuthorAndNoTitleError">

  <p *ngIf="searchPerformed && books.length === 0 && !noAuthorAndNoTitleError">
    No hay resultados, pruebe variando los filtros de búsqueda</p>

  <p *ngIf="noAuthorAndNoTitleError"> Por favor proporciona caracteres en el campo título
    o seleccione un autor en el campo autor después de proporcionar caracteres </p>

  <p *ngIf="!searchPerformed"> Aquí podrás visualizar los resultados de la búsqueda </p>

</div>

<div *ngIf="showSpinner" class="spinner-border c-spinner d-flex justify-content-center align-items-center">
  
</div>

<div class="row c-result-table" *ngIf="books.length !== 0">

  <div class="col col-md-10 offset-md-1 col-lg-6 offset-lg-3">

    <table class="table">
      <tr *ngFor="let book of books">
        <td class="d-flex flex-row c-book-details">
          <img src='/assets/book_pictures/{{book.imageUrl}}' alt="Portada no disponible">

          <div>
            <p>
              <span class="c-title">{{book.name}}</span><br>
              <span>{{book.author.name}}</span>
            </p>
            <!-- Show message available for loan -->
            <ng-container *ngIf="book.canBeLoaned; else waitList">
              <!-- Show message 1 left -->
              <p *ngIf="book.copiesLeft === 1; else moreThan1Copies">
                Disponible para préstamo, hay 1 ejemplar disponible
              </p>
              <!-- Show message more than 1 left -->
              <ng-template #moreThan1Copies>
                <p>
                  Disponible para préstamo, hay
                  {{ book.copiesLeft}} ejemplares disponibles
                </p>
              </ng-template>
            </ng-container>
            <!-- Show message wait list -->
            <ng-template #waitList>
              <p #waitList>Préstamo con lista de espera</p>
            </ng-template>

            <p class="c-book-link">Pulse aquí para más detalles y opciones de préstamo</p>

          </div>


        </td>
      </tr>
    </table>
  </div>


</div>





<!-- <table class = "table">
    <tr *ngFor="let book of books">
      <td>
              <p>Título: {{book.name}}</p>
              <p>Género: {{book.category.name}}</p>
              <p>Subgénero: {{book.subcategory.name}}</p>
              <p>Autor: {{book.author.name}}</p>
              <p>Descripción: {{book.description}}</p>
              <p *ngIf = "book.canBeLoaned">Disponible para préstamo, 
                  hay {{ book.numberCopies - book.numberLoaned}} ejemplar/es disponibles</p>
              <p *ngIf = "! book.canBeLoaned">Préstamo con lista de espera</p>
    </td>
      </tr>
  </table> -->